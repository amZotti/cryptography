<html>
  <head>
    <script>

    var findPrimes = (n) => {
      var primes = [];
      var composites = new Set();

      for (var i = 2;i < n;i++) {
        if (!composites.has(i)) {
          primes.push(i);

          for (var k = i + i;k < n;k += i) {
            composites.add(k);
          }
        }
      }
      return primes;
    };

    var psuedoRandom = () => {
        let seed = Date.now() - Math.floor(Math.random() * 1000000000000);
        let x = Math.sin(seed) * 10000;
        return x - Math.floor(x);
    };

    var MAX = 100000;
    var PRIMES = findPrimes(MAX);

    var greatestCommonDivisor = (a, b) => {
      if (!b) {
          return a;
      }
      return greatestCommonDivisor(b, a % b);
    };


    //e must be odd
    //e cannot share a factor with totient
    var findE = (totient, n) => {
      let i = 1, prime;

      do {
        prime = PRIMES[ i ];
        i++;
      } while(greatestCommonDivisor(prime, totient) !== 1);

      if (prime >= n) {
        throw new Error('Prime too big');
      }

      return prime;
    }

    var findD = (totient, e) => {
      return (1/e) % totient;
    };

    var randomPrimes = () => {
      let i = ~~(Math.random() * PRIMES.length);
      let p = PRIMES[ i ];
      let q = PRIMES[ i - 1 ];
      return [ p, q ];
    };


    undefined

    let p, q;

    [ p, q ] = randomPrimes();

    //let p = 5;
    //let q = 11;
    let m = 20;

    let n = p * q;


    console.log('p: ', p);
    console.log('q: ', q);
    let totient = (p-1) * (q-1);

    let e = findE(totient, n);
    //let d = findD(totient, e);
    var encrypt = (e, n, m) => {
      console.log('encrypt args: ', arguments);
      return Math.pow(m, e) % n;
    };

    var decrypt = (d, n, c) => {
      console.log('decrypt args: ', arguments);
      return Math.pow(c, d) % n;
    };


    //let encrypted = encrypt(e,n, m);


    //let decrypted = decrypt(d,n,encrypted);

  </script>
  </head>
</html>
